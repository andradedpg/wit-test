version: '3'
services:
  lb: 
    container_name: lb
    build: ./.docker/lb/.
    ports:
      - 80:80
    volumes:
      - ./.docker/lb/cfg:/usr/local/etc/haproxy

  proxy:
    container_name: web
    build: ./.docker/web/.
    restart: always
    ports:
    - 80:80
    - 443:443
    volumes:
    - ./.docker/web/nginx.conf:/etc/nginx/conf.d/default.conf
    depends_on:
    - app
    deploy: 
      replicas: 1 

  app:
    container_name: app
    #restart: always
    build: ./.docker/app/.
    expose:
      - "8080"
    deploy: 
      replicas: 1 